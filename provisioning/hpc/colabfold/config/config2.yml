Region: us-east-1
Image:
  Os: ubuntu2004
HeadNode:
  InstanceType: c5.xlarge
  Networking:
    SubnetId: subnet-024f62b6a5be79462
    ElasticIp: true
    SecurityGroups:
     - sg-0a20cff17544a19a2
  Iam:
    S3Access:
      - BucketName: alphafold2servicestack-hpcbucketda3264c9-1n1l8vyid5rs2
        EnableWriteAccess: true
    AdditionalIamPolicies:
      - Policy: arn:aws:iam::aws:policy/SecretsManagerReadWrite
      - Policy: arn:aws:iam::aws:policy/AmazonFSxFullAccess
      - Policy: arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore
  Ssh:
    KeyName: keypair-alphafold2
  CustomActions:
    OnNodeConfigured:
      Script: s3://alphafold2servicestack-hpcbucketda3264c9-1n1l8vyid5rs2/colabfold/scripts/bin/post_install.sh
      Args:
        - fs-0c0fec69e4cc2a2b2
        - alphafold2servicestack-hpcbucketda3264c9-1n1l8vyid5rs2

Scheduling:
  Scheduler: slurm
  SlurmSettings:
    Database:
      Uri: alphafold2servicestack-auroracluster23d869c0-tpyu5zty7vij.cluster-caojp2xix6y8.us-east-1.rds.amazonaws.com:3306
      UserName: hpc
      PasswordSecretArn: arn:aws:secretsmanager:us-east-1:191643194801:secret:AuroraPasswordC8BD72EA-KrNfYPBIII7h-gx4nG0
  SlurmQueues:
    - Name: queue-cpu
      ComputeResources:
        - Name: r6i8xlarge
          InstanceType: r6i.8xlarge
          MinCount: 0
          MaxCount: 10
      Networking:
        SubnetIds:
          - subnet-091bceabb39e53003
    - Name: queue-gpu
      ComputeResources:
        - Name: g4dn2xlarge
          InstanceType: g4dn.2xlarge
          MinCount: 0
          MaxCount: 10
      Networking:
        SubnetIds:
          - subnet-091bceabb39e53003

SharedStorage:
  # Fsx for Lustreの設定
  - MountDir: /fsx
    Name: shared-storage-lustre
    StorageType: FsxLustre
    FsxLustreSettings:
      FileSystemId: fs-0c0fec69e4cc2a2b2
